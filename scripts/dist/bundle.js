(()=>{"use strict";var e={384:(e,t,n)=>{var r=n(952),o=n(112),i=n(102),a=n(782);function c(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return l(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?l(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,c=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){c=!0,i=e},f:function(){try{a||null==n.return||n.return()}finally{if(c)throw i}}}}function l(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}addEventListener("load",(function(){var e=document.getElementById("money");setInterval((function(){var t,n=0,o=c(r.p.fields);try{for(o.s();!(t=o.n()).done;){var i=t.value;n+=(0,r.aZ)(i)}}catch(e){o.e(e)}finally{o.f()}r.UN.money+=n,e&&(e.innerText="money: ".concat(r.UN.money.toFixed(2),"\n").concat(n.toFixed(2),"/s"))}),1e3)})),o.x.click=function(e,t){if(!(r.wT.scale<.5)&&o.x.pressedElement&&o.x.pressedElement===r.p.gamecvs){var n=Math.floor((e-r.wT.x-window.innerWidth/2)/r.wT.scale/50),l=Math.floor((t-r.wT.y-window.innerHeight/2)/r.wT.scale/50);console.log(n,l);var s=r.UN.fields["".concat(n,",").concat(l)];if(void 0!==r.UN.fields["".concat(n,",").concat(l)]&&!s.unlocked){var u=r.D0.calcMoney(s.moisture,s.x,s.y);if(u>r.UN.money)(0,a.A)("你钱不够",["需要".concat(u.toFixed(2)),"但你只有".concat(r.UN.money.toFixed(2))]);else{r.UN.money-=u,r.UN.fields["".concat(n,",").concat(l)]={x:n,y:l,crop:r.Ce.None,moisture:(0,r.aZ)(n,l),unlocked:!0};var f,d=c(r.p.around);try{for(d.s();!(f=d.n()).done;){var v=f.value,h=v[0]+n,m=v[1]+l;r.UN.fields["".concat(h,",").concat(m)]||(r.UN.fields["".concat(h,",").concat(m)]={x:h,y:m,crop:r.Ce.None,moisture:(0,r.aZ)(v[0],v[1]),unlocked:!1})}}catch(e){d.e(e)}finally{d.f()}(0,i.E)(),(0,i.X)()}}}},addEventListener("load",(function(){var e=document.getElementById("save"),t=document.getElementById("load"),n=document.createElement("a"),o=document.createElement("input");o.type="file",o.addEventListener("change",(function(e){var t,n=null===(t=e.target.files)||void 0===t?void 0:t[0];if(n){var o=new FileReader;o.onload=function(e){var t,n=null===(t=e.target)||void 0===t?void 0:t.result;try{(0,r.k4)(JSON.parse((0,r.Pz)(n))),(0,i.E)(),(0,i.X)()}catch(e){console.error("加载失败\nError parsing JSON:",e)}},o.onerror=function(e){console.error("Error reading file:",e)},o.readAsText(n)}})),e&&t&&(e.onclick=function(){var e=JSON.parse(JSON.stringify(r.UN));e.version=r.xv;var t=(0,r.K3)(JSON.stringify(e)),o=new Blob([t],{type:"text/plain"}),i=URL.createObjectURL(o);n.href=i,n.download="farmer.save",n.click(),URL.revokeObjectURL(i)},t.onclick=function(){o.click(),(0,i.E)(),(0,i.X)()})})),setInterval((function(){localStorage.setItem("save",(0,r.K3)(JSON.stringify(r.UN)))}),1e4),addEventListener("load",(function(){document.getElementById("home").onclick=function(){r.wT.scale=2,r.wT.x=0,r.wT.y=0,(0,i.E)(),(0,i.X)()}}))},112:(e,t,n)=>{function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,i(r.key),r)}}function i(e){var t=function(e){if("object"!=r(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=r(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==r(t)?t:t+""}n.d(t,{x:()=>a});var a=new(function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.pressed=!1,this.pressedElement=null,this.lastX=0,this.lastY=0,this.startX=0,this.startY=0,this.startDistance=0,this.lastDistance=0,this._move=[],this._click=[],this._scroll=[],this.initMouse(),this.initTouch()},t=[{key:"initMouse",value:function(){var e=this;document.addEventListener("mousemove",(function(t){requestAnimationFrame((function(){e._move.forEach((function(e){e(t.movementX,t.movementY)}))}))})),document.addEventListener("mousedown",(function(t){e.startX=t.offsetX,e.startY=t.offsetY,e.pressedElement=t.target,e.pressed=!0})),document.addEventListener("mouseup",(function(t){var n=t.offsetX-e.startX,r=t.offsetY-e.startY;Math.abs(n)<5&&Math.abs(r)<5&&e._click.forEach((function(e){e(t.offsetX,t.offsetY)})),e.pressedElement=null,e.pressed=!1})),document.addEventListener("wheel",(function(t){e._scroll.forEach((function(e){e(1+t.deltaY/100,t.altKey)}))}))}},{key:"initTouch",value:function(){var e=this;document.addEventListener("touchmove",(function(t){var n=t.touches[0].clientX-e.lastX,r=t.touches[0].clientY-e.lastY;e.lastX=t.touches[0].clientX,e.lastY=t.touches[0].clientY;var o=e.getTouchDistance(t)-e.lastDistance;e.lastDistance=e.getTouchDistance(t),isNaN(o)?requestAnimationFrame((function(){e._move.forEach((function(e){e(n,r)}))})):Math.abs(o)<5&&requestAnimationFrame((function(){e._scroll.forEach((function(t){t((o+e.startDistance)/e.startDistance,!1)}))}))})),document.addEventListener("touchstart",(function(t){e.lastX=t.touches[0].clientX,e.lastY=t.touches[0].clientY,e.startX=t.touches[0].clientX,e.startY=t.touches[0].clientY,e.startDistance=e.getTouchDistance(t),e.lastDistance=e.getTouchDistance(t),e.pressedElement=t.target,e.pressed=!0})),document.addEventListener("touchend",(function(t){e.pressedElement=null,e.pressed=!1}))}},{key:"getTouchDistance",value:function(e){if(e.touches.length<2)return NaN;var t=e.touches[0],n=e.touches[1];return Math.hypot(n.clientX-t.clientX,n.clientY-t.clientY)}},{key:"move",set:function(e){this._move.push(e)}},{key:"click",set:function(e){this._click.push(e)}},{key:"scroll",set:function(e){this._scroll.push(e)}}],t&&o(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}())},782:(e,t,n)=>{n.d(t,{A:()=>c});const r=window.React,o=window.ReactDOM;var i={};function a(e){var t=e.title,n=e.content,o=e.children;return r.createElement("div",{className:"notice"},r.createElement("div",{className:"notice-title"},r.createElement("button",{style:{background:"rgba(0,0,0,0.5)",border:"none",color:"white",height:"100%",aspectRatio:"1/1",fontSize:"20px"},onMouseOver:function(e){e.currentTarget.style.backgroundColor="rgba(255,0,0,0.5)"},onMouseOut:function(e){e.currentTarget.style.backgroundColor="rgba(0,0,0,0.5)"},onClick:function(e){!function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];i[e]&&i[e].forEach((function(e){return e.callback.apply(e,n)}))}("notice-close")}},"×"),r.createElement("span",{style:{color:"white",textAlign:"center",width:"100%",fontSize:"20px",fontWeight:"bold"}},t)),r.createElement("div",{className:"notice-content"},r.createElement("p",null,n),o))}const c=function(e,t,n){var c=(0,o.createRoot)(document.getElementById("root"));"string"==typeof t&&(t=[t]);var l=t.map((function(e,t){return r.createElement("p",{key:t},e)}));void 0!==n&&(n.key=t.length.toString(),l.push(n)),c.render(r.createElement(a,{title:e,content:""},l));var s=function(e,t){i[e]=i[e]||[];var n={callback:t,id:Date.now()};return i[e].push({id:n.id,callback:n.callback}),n}("notice-close",(function(){c.unmount(),function(e){for(var t in i)i[t]=i[t].filter((function(t){return t.id!==e}))}(s.id)}))}},102:(e,t,n)=>{n.d(t,{E:()=>l,X:()=>s});var r=n(952),o=n(112),i=n(782),a=n(818);function c(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function l(){r.p.fields=[];for(var e=50*r.wT.scale,t=1/Math.PI/2,n=-1;n*e<r.p.gamecvs.width;n+=1)for(var o=-1;o*e<r.p.gamecvs.height;o+=1){var i=n-Math.floor((r.wT.x+r.p.gamecvs.width/2)/e),a=o-Math.floor((r.wT.y+r.p.gamecvs.height/2)/e);if(void 0!==r.UN.fields["".concat(i,",").concat(a)]){var c=r.p.noise.perlin2(i*t,a*t);c=(c+1)/2,r.p.fields.push(new r.D0(i,a,c))}}}function s(){var e=r.p.gamecvs.getContext("2d"),t=r.p.gamecvs.width,n=r.p.gamecvs.height;e.clearRect(0,0,t,n),e.fillStyle="#294f1d",e.fillRect(0,0,t,n),e.font="".concat(10*r.wT.scale,"px sans-serif"),r.p.fields.forEach((function(e){return e.render()}))}addEventListener("load",(function(){r.p.gamecvs=document.getElementById("game"),function(){if(r.wT.x=0,r.wT.y=0,r.wT.scale=2,r.p.gamecvs.width=window.innerWidth,r.p.gamecvs.height=window.innerHeight,r.p.gamecvs.getContext("2d").font="".concat(10*r.wT.scale,"px sans-serif"),localStorage.getItem("save")){var e=localStorage.getItem("save");(0,r.k4)(JSON.parse((0,r.Pz)(e)))||(0,i.A)("新版本：".concat(a.r,"!"),a.z)}else{r.UN.fields["0,0"]={x:0,y:0,crop:r.Ce.None,unlocked:!0,moisture:(0,r.aZ)(0,0)};var t,n=function(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return c(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?c(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,l=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){l=!0,i=e},f:function(){try{a||null==n.return||n.return()}finally{if(l)throw i}}}}(r.p.around);try{for(n.s();!(t=n.n()).done;){var o=t.value;r.UN.fields["".concat(o[0],",").concat(o[1])]={x:o[0],y:o[1],crop:r.Ce.None,unlocked:!1,moisture:(0,r.aZ)(o[0],o[1])}}}catch(e){n.e(e)}finally{n.f()}}l(),s()}()})),window.onresize=function(){r.p.gamecvs.width=window.innerWidth,r.p.gamecvs.height=window.innerHeight,l(),s()},o.x.move=function(e,t){o.x.pressed&&o.x.pressedElement&&o.x.pressedElement===r.p.gamecvs&&(r.wT.x+=e,r.wT.y+=t,l(),s())},o.x.scroll=function(e){if(!o.x.pressed||o.x.pressedElement===r.p.gamecvs){var t=r.wT.scale;r.wT.scale*=e,r.wT.scale=Math.max(.1,r.wT.scale),r.wT.scale=Math.min(10,r.wT.scale),t=r.wT.scale/t,r.wT.x*=t,r.wT.y*=t,l(),s()}}},952:(e,t,n)=>{n.d(t,{Ce:()=>x,D0:()=>p,xv:()=>g,K3:()=>k,aZ:()=>T,p:()=>b,k4:()=>N,UN:()=>w,wT:()=>E,Pz:()=>S});const r=window.Noise;var o=n.n(r),i=n(818);function a(e){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a(e)}function c(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=l(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,c=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){c=!0,i=e},f:function(){try{a||null==n.return||n.return()}finally{if(c)throw i}}}}function l(e,t){if(e){if("string"==typeof e)return s(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?s(e,t):void 0}}function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function f(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,v(r.key),r)}}function d(e,t,n){return t&&f(e.prototype,t),n&&f(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function v(e){var t=function(e){if("object"!=a(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=a(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==a(t)?t:t+""}var h={Unknown:{color:"#000000",innerText:"未知",range:[NaN,NaN]},Desert:{color:"#ffd68f",innerText:"沙漠",range:[0,.1]},Saline:{color:"#ffffff",innerText:"盐碱地",range:[.1,.3]},Barren:{color:"#c29c0d",innerText:"贫瘠地",range:[.3,.5]},Regular:{color:"#b56605",innerText:"普通土地",range:[.5,.7]},Nunja:{color:"#7d710a",innerText:"沼泽地",range:[.7,.9]},Lake:{color:"#0085e3",innerText:"湖泊",range:[.9,1]}};function m(e){for(var t in h){var n=h[t];if(n.range[0]<=e&&n.range[1]>e)return n}return h.Unknown}var y=function(){return d((function e(t,n,r,o,i){var a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"";u(this,e),this.x=t,this.y=n,this.width=r,this.height=o,this.color=i,this.innerText=a}),[{key:"render",value:function(){var e=this,t=b.gamecvs.getContext("2d");if(null!==t&&(t.fillStyle=this.color,E.scale,t.fillRect(this.x,this.y,this.width,this.height),""!==this.innerText)){var n=this.innerText.split("\n"),r=parseInt(t.font,10),o=n.length*r,i=n.map((function(e){return t.measureText(e).width})),a=this.height/2-o/2+r;t.fillStyle="#ffffff"===this.color?"#000000":"#ffffff",n.forEach((function(n,o){t.fillText(n,e.x+e.width/2-i[o]/2,e.y+a+o*r)}))}}}])}(),p=function(){function e(t,n,r){u(this,e),this.unlocked=!1,this.x=t,this.y=n,this.moisture=r,this.basicColor="#ffb400";var o=w.fields["".concat(t,",").concat(n)];void 0!==o&&(this.moisture=o.moisture,this.unlocked=o.unlocked);var i="";E.scale>.5&&(i=this.unlocked?m(this.moisture).innerText:"花费".concat(e.calcMoney(this))),this.box=new y(50*t*E.scale+E.x+window.innerWidth/2,50*n*E.scale+E.y+window.innerHeight/2,50*E.scale,50*E.scale,this.color(),i)}return d(e,[{key:"render",value:function(){this.box.render()}},{key:"color",value:function(){return this.unlocked?m(this.moisture).color:"#ffffff7f"}}],[{key:"calcMoney",value:function(t,n,r){if("number"!=typeof t)return e.calcMoney(t.moisture,t.x,t.y);if(void 0===n||void 0===r)throw new Error("x or y is undefined when calcMoney");return Math.floor((t+1)*Math.pow(n*n+r*r,1.3))}}])}(),g=i.r,w={fields:{},money:0,seed:Math.floor(1e9*Math.random()),version:g},b={gamecvs:document.getElementById("game"),fields:[],noise:new(o()),around:[[-1,-1],[0,-1],[1,-1],[-1,0],[1,0],[-1,1],[0,1],[1,1]]};b.noise=new(o())(w.seed),console.log(w.seed);var x,E={x:0,y:0,scale:1};function T(e,t){E.scale;var n=1/Math.PI/2;if("number"==typeof e){if(void 0===t)return 0;var r=b.noise.perlin2(e*n,t*n);return(r+1)/2}return e.moisture}function k(e){return btoa(unescape(encodeURIComponent(e)))}function S(e){return decodeURIComponent(escape(atob(e)))}function N(e){var t,n,r,o=JSON.parse(JSON.stringify(e));b.noise.seed(o.seed||w.seed),console.log("readed version ".concat(o.version?o.version:"unknown")),console.log("current version ".concat(g)),t=o.version==g,o.version=g;for(var i=0,a=Object.entries(e);i<a.length;i++){var s=(n=a[i],r=2,function(e){if(Array.isArray(e))return e}(n)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i,a,c=[],l=!0,s=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;l=!1}else for(;!(l=(r=i.call(n)).done)&&(c.push(r.value),c.length!==t);l=!0);}catch(e){s=!0,o=e}finally{try{if(!l&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(s)throw o}}return c}}(n,r)||l(n,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),u=s[0],f=s[1];if("fields"===u){if(f instanceof Array){var d,v={},h=c(f);try{for(h.s();!(d=h.n()).done;){var m=d.value;v["".concat(m.x,",").concat(m.y)]=m}}catch(e){h.e(e)}finally{h.f()}o[u]=v}for(var y in o[u])if("moisture"in o[u][y]&&void 0!==o[u][y].moisture||(o[u][y].moisture=T(o[u][y].x,o[u][y].y)),"unlocked"in o[u][y]&&void 0!==o[u][y].unlocked||(o[u][y].unlocked=!0),"crop"in o[u][y]&&void 0!==o[u][y].crop||(o[u][y].crop=x.None),o[u][y].unlocked){var p,E=c(b.around);try{for(E.s();!(p=E.n()).done;){var k=p.value,S=k[0]+o[u][y].x,N=k[1]+o[u][y].y;o[u]["".concat(S,",").concat(N)]||(o[u]["".concat(S,",").concat(N)]={x:S,y:N,crop:x.None,unlocked:!1,moisture:T(S,N)})}}catch(e){E.e(e)}finally{E.f()}}}}return Object.assign(w,o),t}!function(e){e[e.None=0]="None",e[e.Corn=1]="Corn"}(x||(x={}))},818:e=>{e.exports=JSON.parse('{"r":"1.0.8","z":["- 升级至 1.0.8 版本","- 在界面上添加了一个新的返回按钮，点击后可将视野重置到地图中心点"]}')}},t={};function n(r){var o=t[r];if(void 0!==o)return o.exports;var i=t[r]={exports:{}};return e[r](i,i.exports,n),i.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n(384),n(952),n(102),n(112),n(782)})();