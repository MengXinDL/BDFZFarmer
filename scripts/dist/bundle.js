(()=>{"use strict";var e={184:(e,t,s)=>{var n=s(979),i=s(112),o=s(846);addEventListener("load",(()=>{let e=document.getElementById("money");setInterval((()=>{let t=0;n.UN.fields.forEach((e=>{t+=(0,n.aZ)(e.x,e.y)})),n.UN.money+=t,e&&(e.innerText=`money: ${n.UN.money.toFixed(2)}\n${t.toFixed(2)}/s`)}),1e3)})),i.x.click=(e,t)=>{if(n.wT.scale<.5)return;if(!i.x.pressedElement||i.x.pressedElement!==n.p.gamecvs)return;let s=Math.floor((e-n.wT.x)/n.wT.scale/50),r=Math.floor((t-n.wT.y)/n.wT.scale/50);if(n.UN.fields.some((e=>e.x===s&&e.y===r)))return;let c=n.p.fields.find((e=>e.x===s&&e.y===r));c&&c.canBuy&&(n.D0.calcMoney(c)>n.UN.money?alert(`你钱不够\n需要${n.D0.calcMoney(c)}\n但你只有${n.UN.money.toFixed(2)}\n`):(n.UN.money-=n.D0.calcMoney(c),n.UN.fields.push({x:s,y:r,crop:n.Ce.corn}),(0,o.E)(),(0,o.X)()))},addEventListener("load",(()=>{const e=document.getElementById("save"),t=document.getElementById("load"),s=document.createElement("a"),i=document.createElement("input");i.type="file",i.addEventListener("change",(e=>{var t;const s=null===(t=e.target.files)||void 0===t?void 0:t[0];if(s){const e=new FileReader;e.onload=e=>{var t;const s=null===(t=e.target)||void 0===t?void 0:t.result;try{Object.assign(n.UN,(0,n._0)(JSON.parse((0,n.Pz)(s)))),n.p.noise.seed(n.UN.seed),(0,o.E)(),(0,o.X)()}catch(e){console.error("加载失败\nError parsing JSON:",e)}},e.onerror=e=>{console.error("Error reading file:",e)},e.readAsText(s)}})),e&&t&&(e.onclick=()=>{let e=JSON.parse(JSON.stringify(n.UN));e.version=n.xv;const t=(0,n.K3)(JSON.stringify(e)),i=new Blob([t],{type:"text/plain"}),o=URL.createObjectURL(i);s.href=o,s.download="farmer.save",s.click(),URL.revokeObjectURL(o)},t.onclick=()=>{i.click(),(0,o.E)(),(0,o.X)()})})),setInterval((()=>{localStorage.setItem("save",(0,n.K3)(JSON.stringify(n.UN)))}),1e4),addEventListener("load",(()=>{document.getElementById("home").onclick=()=>{n.wT.scale=2,n.wT.x=window.innerWidth/2,n.wT.y=window.innerHeight/2,(0,o.E)(),(0,o.X)()}}))},112:(e,t,s)=>{s.d(t,{x:()=>n});const n=new class{constructor(){this.pressed=!1,this.pressedElement=null,this.lastX=0,this.lastY=0,this.startX=0,this.startY=0,this.startDistance=0,this.lastDistance=0,this._move=[],this._click=[],this._scroll=[],this.initMouse(),this.initTouch()}initMouse(){document.addEventListener("mousemove",(e=>{requestAnimationFrame((()=>{this._move.forEach((t=>{t(e.movementX,e.movementY)}))}))})),document.addEventListener("mousedown",(e=>{this.startX=e.offsetX,this.startY=e.offsetY,this.pressedElement=e.target,this.pressed=!0})),document.addEventListener("mouseup",(e=>{let t=e.offsetX-this.startX,s=e.offsetY-this.startY;Math.abs(t)<5&&Math.abs(s)<5&&this._click.forEach((t=>{t(e.offsetX,e.offsetY)})),this.pressedElement=null,this.pressed=!1})),document.addEventListener("wheel",(e=>{this._scroll.forEach((t=>{t(e.deltaY,e.altKey)}))}))}initTouch(){document.addEventListener("touchmove",(e=>{let t=e.touches[0].clientX-this.lastX,s=e.touches[0].clientY-this.lastY;this.lastX=e.touches[0].clientX,this.lastY=e.touches[0].clientY;let n=this.getTouchDistance(e)-this.lastDistance;this.lastDistance=this.getTouchDistance(e),isNaN(n)?requestAnimationFrame((()=>{this._move.forEach((e=>{e(t,s)}))})):Math.abs(n)<5&&requestAnimationFrame((()=>{this._scroll.forEach((e=>{e(n,!1)}))}))})),document.addEventListener("touchstart",(e=>{this.lastX=e.touches[0].clientX,this.lastY=e.touches[0].clientY,this.startX=e.touches[0].clientX,this.startY=e.touches[0].clientY,this.startDistance=this.getTouchDistance(e),this.lastDistance=this.getTouchDistance(e),this.pressedElement=e.target,this.pressed=!0})),document.addEventListener("touchend",(e=>{this.pressedElement=null,this.pressed=!1}))}getTouchDistance(e){if(e.touches.length<2)return NaN;const t=e.touches[0],s=e.touches[1];return Math.hypot(s.clientX-t.clientX,s.clientY-t.clientY)}set move(e){this._move.push(e)}set click(e){this._click.push(e)}set scroll(e){this._scroll.push(e)}}},846:(e,t,s)=>{s.d(t,{E:()=>o,X:()=>r});var n=s(979),i=s(112);function o(){n.p.fields=[];let e=50*n.wT.scale,t=1/Math.PI/2;for(let s=-1;s*e<n.p.gamecvs.width;s+=1)for(let i=-1;i*e<n.p.gamecvs.height;i+=1){let o=s-Math.floor(n.wT.x/e),r=i-Math.floor(n.wT.y/e),c=n.p.noise.perlin2(o*t,r*t);c=(c+1)/2,n.p.fields.push(new n.D0(o,r,c))}}function r(){const e=n.p.gamecvs.getContext("2d");let t=n.p.gamecvs.width,s=n.p.gamecvs.height;e.clearRect(0,0,t,s),n.wT.scale>.5?e.fillStyle="#539e3b":e.fillStyle="#294f1d",e.fillRect(0,0,t,s),e.font=10*n.wT.scale+"px sans-serif",n.p.fields.forEach((e=>e.render()))}addEventListener("load",(function(){n.p.gamecvs=document.getElementById("game"),function(){if(n.wT.x=window.innerWidth/2,n.wT.y=window.innerHeight/2,n.wT.scale=2,n.p.gamecvs.width=window.innerWidth,n.p.gamecvs.height=window.innerHeight,n.p.gamecvs.getContext("2d").font=10*n.wT.scale+"px sans-serif",localStorage.getItem("save")){let e=localStorage.getItem("save");Object.assign(n.UN,(0,n._0)(JSON.parse((0,n.Pz)(e)))),n.p.noise.seed(n.UN.seed)}else n.UN.fields.push({x:0,y:0,crop:0});null!==(0,n.u1)("#ffb400")?(o(),r()):console.error("Invalid color")}()})),window.onresize=function(){n.p.gamecvs.width=window.innerWidth,n.p.gamecvs.height=window.innerHeight,o(),r()},i.x.move=(e,t)=>{i.x.pressed&&i.x.pressedElement&&i.x.pressedElement===n.p.gamecvs&&(n.wT.x+=e,n.wT.y+=t,o(),r())},i.x.scroll=e=>{if(i.x.pressed&&i.x.pressedElement!==n.p.gamecvs)return;let t=1+e/100;n.wT.scale*=t,n.wT.scale=Math.max(.1,n.wT.scale),n.wT.scale=Math.min(10,n.wT.scale),o(),r()}},979:(e,t,s)=>{s.d(t,{Ce:()=>f,D0:()=>o,xv:()=>r,K3:()=>u,aZ:()=>d,p:()=>a,u1:()=>h,_0:()=>p,UN:()=>c,wT:()=>l,Pz:()=>m});const n={Unknown:{color:"#000000",innerText:"未知",range:[NaN,NaN]},Desert:{color:"#ffd68f",innerText:"沙漠",range:[0,.1]},Saline:{color:"#ffffff",innerText:"盐碱地",range:[.1,.3]},Barren:{color:"#c29c0d",innerText:"贫瘠地",range:[.3,.5]},Regular:{color:"#b56605",innerText:"普通土地",range:[.5,.7]},Nunja:{color:"#7d710a",innerText:"沼泽地",range:[.7,.9]},Lake:{color:"#0085e3",innerText:"湖泊",range:[.9,1]}};class i{constructor(e,t,s,n,i,o=""){this.x=e,this.y=t,this.width=s,this.height=n,this.color=i,this.innerText=o}render(){let e=a.gamecvs.getContext("2d");if(null===e)return;if(e.fillStyle=this.color,l.scale>.5?e.fillRect(this.x+1,this.y+1,this.width-1,this.height-1):e.fillRect(this.x,this.y,this.width,this.height),""===this.innerText)return;const t=this.innerText.split("\n"),s=parseInt(e.font,10),n=t.length*s,i=t.map((t=>e.measureText(t).width)),o=this.height/2-n/2+s;e.fillStyle="#ffffff"===this.color?"#000000":"#ffffff",t.forEach(((t,n)=>{e.fillText(t,this.x+this.width/2-i[n]/2,this.y+o+n*s)}))}}class o{constructor(e,t,s,n=!1){this.unlocked=!1,this.canBuy=!1,this.x=e,this.y=t,this.moisture=s,this.basicColor="#ffb400";let r=c.fields.find((s=>s.x===e&&s.y===t));if(void 0!==r&&(this.moisture=d(r),this.unlocked=!0),void 0===r)for(const e of a.around){if(this.canBuy)break;c.fields.some((t=>t.x===e[0]+this.x&&t.y===e[1]+this.y&&(this.canBuy=!0,!0)))}let h="";l.scale>.5&&(this.unlocked?h=`肥沃度${(100*this.moisture).toFixed(0)}`:this.canBuy&&(h=`花费${o.calcMoney(this)}`)),this.box=new i(50*e*l.scale+l.x,50*t*l.scale+l.y,50*l.scale,50*l.scale,this.color(),h)}render(){!this.canBuy&&!this.unlocked&&l.scale<.5||this.box.render()}color(){return this.unlocked?function(e){for(let t in n){let s=n[t];if(s.range[0]<=e&&s.range[1]>e)return s}return n.Unknown}(this.moisture).color:this.canBuy?"#7f7f7f7f":"#0000007f"}static calcMoney(e,t,s){if("number"!=typeof e)return o.calcMoney(e.moisture,e.x,e.y);if(void 0===t||void 0===s)throw new Error("x or y is undefined when calcMoney");return Math.floor((e+1)*Math.pow(t*t+s*s,1.3))}}const r="0.2.12",c={fields:[],money:0,seed:Math.floor(1e9*Math.random())},a={gamecvs:document.getElementById("game"),fields:[],noise:new window.Noise,around:[[-1,-1],[0,-1],[1,-1],[-1,0],[1,0],[-1,1],[0,1],[1,1]]};a.noise=new window.Noise(c.seed),console.log(c.seed);const l={x:0,y:0,scale:1};function h(e){let t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}:null}function d(e,t){l.scale;let s=1/Math.PI/2;if("number"==typeof e){if(void 0===t)return 0;let n=a.noise.perlin2(e*s,t*s);return n=(n+1)/2,n}return"moisture"in e?e.moisture:d(e.x,e.y)}var f;function u(e){return btoa(unescape(encodeURIComponent(e)))}function m(e){return decodeURIComponent(escape(atob(e)))}function p(e){return e}!function(e){e[e.corn=0]="corn"}(f||(f={}))}},t={};function s(n){var i=t[n];if(void 0!==i)return i.exports;var o=t[n]={exports:{}};return e[n](o,o.exports,s),o.exports}s.d=(e,t)=>{for(var n in t)s.o(t,n)&&!s.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),s(184),s(979),s(846),s(112)})();