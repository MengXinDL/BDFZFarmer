(()=>{"use strict";var e={184:(e,t,s)=>{var i=s(939),n=s(112),o=s(846);addEventListener("load",(()=>{let e=document.getElementById("money");setInterval((()=>{let t=0;i.UN.fields.forEach((e=>{t+=(0,i.kE)(e.x,e.y)})),i.UN.money+=t,e&&(e.innerText=`money: ${i.UN.money.toFixed(2)}\n${t.toFixed(2)}/s`)}),1e3)})),n.x.click=(e,t)=>{if(i.wT.scale<.5)return;if(!n.x.pressedElement||n.x.pressedElement!==i.p.gamecvs)return;let s=Math.floor((e-i.wT.x)/i.wT.scale/50),r=Math.floor((t-i.wT.y)/i.wT.scale/50);if(i.UN.fields.some((e=>e.x===s&&e.y===r)))return;let c=i.p.fields.find((e=>e.x===s&&e.y===r));c&&c.canBuy&&(i.D0.calcMoney(c)>i.UN.money?alert(`你钱不够\n需要${i.D0.calcMoney(c)}\n但你只有${i.UN.money.toFixed(2)}\n`):(i.UN.money-=i.D0.calcMoney(c),i.UN.fields.push({x:s,y:r,crop:i.Ce.corn}),(0,o.E)(),(0,o.X)()))},addEventListener("load",(()=>{const e=document.getElementById("save"),t=document.getElementById("load"),s=document.createElement("a"),n=document.createElement("input");n.type="file",n.addEventListener("change",(e=>{var t;const s=null===(t=e.target.files)||void 0===t?void 0:t[0];if(s){const e=new FileReader;e.onload=e=>{var t;const s=null===(t=e.target)||void 0===t?void 0:t.result;try{Object.assign(i.UN,JSON.parse((0,i.Pz)(s))),i.p.noise.seed(i.UN.seed),(0,o.E)(),(0,o.X)()}catch(e){console.error("加载失败\nError parsing JSON:",e)}},e.onerror=e=>{console.error("Error reading file:",e)},e.readAsText(s)}})),e&&t&&(e.onclick=()=>{let e=JSON.parse(JSON.stringify(i.UN));e.version=i.xv;const t=(0,i.K3)(JSON.stringify(e)),n=new Blob([t],{type:"text/plain"}),o=URL.createObjectURL(n);s.href=o,s.download="farmer.save",s.click(),URL.revokeObjectURL(o)},t.onclick=()=>{n.click(),(0,o.E)(),(0,o.X)()})})),setInterval((()=>{try{fetch("../statics/version.json").then((e=>e.json())).then((e=>{console.log(e),e.version!==i.xv&&alert(`有新版本了\n${e.details.join("\n")}\n建议保存并刷新`)}))}catch(e){}}),6e4)},112:(e,t,s)=>{s.d(t,{x:()=>i});const i=new class{constructor(){this.pressed=!1,this.pressedElement=null,this.lastX=0,this.lastY=0,this.startX=0,this.startY=0,this.startDistance=0,this.lastDistance=0,this._move=[],this._click=[],this._scroll=[],this.initMouse(),this.initTouch()}initMouse(){document.addEventListener("mousemove",(e=>{requestAnimationFrame((()=>{this._move.forEach((t=>{t(e.movementX,e.movementY)}))}))})),document.addEventListener("mousedown",(e=>{this.startX=e.offsetX,this.startY=e.offsetY,this.pressedElement=e.target,this.pressed=!0})),document.addEventListener("mouseup",(e=>{let t=e.offsetX-this.startX,s=e.offsetY-this.startY;Math.abs(t)<5&&Math.abs(s)<5&&this._click.forEach((t=>{t(e.offsetX,e.offsetY)})),this.pressedElement=null,this.pressed=!1,console.log("clicked")})),document.addEventListener("wheel",(e=>{this._scroll.forEach((t=>{t(e.deltaY,e.altKey)}))}))}initTouch(){document.addEventListener("touchmove",(e=>{let t=e.touches[0].clientX-this.lastX,s=e.touches[0].clientY-this.lastY;this.lastX=e.touches[0].clientX,this.lastY=e.touches[0].clientY;let i=this.getTouchDistance(e)-this.lastDistance;this.lastDistance=this.getTouchDistance(e),0!==i?requestAnimationFrame((()=>{this._scroll.forEach((e=>{e(i,!1)}))})):requestAnimationFrame((()=>{this._move.forEach((e=>{e(t,s)}))}))})),document.addEventListener("touchstart",(e=>{this.lastX=e.touches[0].clientX,this.lastY=e.touches[0].clientY,this.startX=e.touches[0].clientX,this.startY=e.touches[0].clientY,this.startDistance=this.getTouchDistance(e),this.lastDistance=this.getTouchDistance(e),this.pressedElement=e.target,this.pressed=!0})),document.addEventListener("touchend",(e=>{this.pressedElement=null,this.pressed=!1}))}getTouchDistance(e){if(e.touches.length<2)return 0;const t=e.touches[0],s=e.touches[1];return Math.hypot(s.clientX-t.clientX,s.clientY-t.clientY)}set move(e){this._move.push(e)}set click(e){this._click.push(e)}set scroll(e){this._scroll.push(e)}}},846:(e,t,s)=>{s.d(t,{E:()=>o,X:()=>r});var i=s(939),n=s(112);function o(){i.p.fields=[];let e=50*i.wT.scale,t=1/Math.PI/2;for(let s=-1;s*e<i.p.gamecvs.width;s+=1)for(let n=-1;n*e<i.p.gamecvs.height;n+=1){let o=s-Math.floor(i.wT.x/e),r=n-Math.floor(i.wT.y/e),c=i.p.noise.perlin2(o*t,r*t);c=(c+1)/2,i.p.fields.push(new i.D0(o,r,c))}}function r(){const e=i.p.gamecvs.getContext("2d");let t=i.p.gamecvs.width,s=i.p.gamecvs.height;e.clearRect(0,0,t,s),i.wT.scale>.5?e.fillStyle="#539e3b":e.fillStyle="#294f1d",e.fillRect(0,0,t,s),e.font=10*i.wT.scale+"px sans-serif",i.p.fields.forEach((e=>e.render()))}addEventListener("load",(function(){i.p.gamecvs=document.getElementById("game"),i.wT.x=window.innerWidth/2,i.wT.y=window.innerHeight/2,i.wT.scale=2,i.p.gamecvs.width=window.innerWidth,i.p.gamecvs.height=window.innerHeight,i.p.gamecvs.getContext("2d").font=10*i.wT.scale+"px sans-serif",i.UN.fields.push({x:0,y:0,crop:0}),null!==(0,i.u1)("#ffb400")?(o(),r()):console.error("Invalid color")})),window.onresize=function(){i.p.gamecvs.width=window.innerWidth,i.p.gamecvs.height=window.innerHeight,o(),r()},n.x.move=(e,t)=>{n.x.pressed&&n.x.pressedElement&&n.x.pressedElement===i.p.gamecvs&&(i.wT.x+=e,i.wT.y+=t,o(),r())},n.x.scroll=e=>{if(n.x.pressed&&n.x.pressedElement!==i.p.gamecvs)return;let t=1+e/100;i.wT.scale*=t,i.wT.scale=Math.max(.1,i.wT.scale),i.wT.scale=Math.min(10,i.wT.scale),o(),r()}},939:(e,t,s)=>{var i;s.d(t,{Ce:()=>f,D0:()=>o,K3:()=>u,Pz:()=>m,UN:()=>c,kE:()=>d,p:()=>l,u1:()=>h,wT:()=>a,xv:()=>r}),function(e){e[e["#ffffff"]=0]="#ffffff",e[e["#d1a20a"]=1]="#d1a20a",e[e["#a35d1d"]=2]="#a35d1d",e[e["#a3330e"]=3]="#a3330e",e[e["#613400"]=4]="#613400"}(i||(i={}));class n{constructor(e,t,s,i,n,o=""){this.x=e,this.y=t,this.width=s,this.height=i,this.color=n,this.innerText=o}render(){let e=l.gamecvs.getContext("2d");if(null===e)return;if(e.fillStyle=this.color,a.scale>.5?e.fillRect(this.x+1,this.y+1,this.width-1,this.height-1):e.fillRect(this.x,this.y,this.width,this.height),""===this.innerText)return;const t=this.innerText.split("\n"),s=parseInt(e.font,10),i=t.length*s,n=t.map((t=>e.measureText(t).width)),o=this.height/2-i/2+s;e.fillStyle="#ffffff"===this.color?"#000000":"#ffffff",t.forEach(((t,i)=>{e.fillText(t,this.x+this.width/2-n[i]/2,this.y+o+i*s)}))}}class o{constructor(e,t,s,i=!1){this.unlocked=!1,this.canBuy=!1,this.x=e,this.y=t,this.fertility=s,this.basicColor="#ffb400";let r=c.fields.find((s=>s.x===e&&s.y===t));if(void 0!==r&&(this.fertility=d(r),this.unlocked=!0),void 0===r)for(const e of l.around){if(this.canBuy)break;c.fields.some((t=>t.x===e[0]+this.x&&t.y===e[1]+this.y&&(this.canBuy=!0,!0)))}let h="";a.scale>.5&&(this.unlocked?h=`肥沃度${(100*this.fertility).toFixed(0)}`:this.canBuy&&(h=`花费${o.calcMoney(this)}`)),this.box=new n(50*e*a.scale+a.x,50*t*a.scale+a.y,50*a.scale,50*a.scale,this.color(),h)}render(){!this.canBuy&&!this.unlocked&&a.scale<.5||this.box.render()}color(){return this.unlocked?i[Math.floor(5*this.fertility)]:this.canBuy?"#7f7f7f7f":"#0000007f"}static calcMoney(e,t,s){if("number"!=typeof e)return o.calcMoney(e.fertility,e.x,e.y);if(void 0===t||void 0===s)throw new Error("x or y is undefined when calcMoney");return Math.floor((e+1)*Math.pow(t*t+s*s,1.3))}}const r="0.2.9",c={fields:[],money:0,seed:Math.floor(1e9*Math.random())},l={gamecvs:document.getElementById("game"),fields:[],noise:new window.Noise,around:[[-1,-1],[0,-1],[1,-1],[-1,0],[1,0],[-1,1],[0,1],[1,1]]};l.noise=new window.Noise(c.seed),console.log(c.seed);const a={x:0,y:0,scale:1};function h(e){let t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}:null}function d(e,t){a.scale;let s=1/Math.PI/2;if("number"==typeof e){if(void 0===t)return 0;let i=l.noise.perlin2(e*s,t*s);return i=(i+1)/2,i}return"fertility"in e?e.fertility:d(e.x,e.y)}var f;function u(e){return btoa(unescape(encodeURIComponent(e)))}function m(e){return decodeURIComponent(escape(atob(e)))}!function(e){e[e.corn=0]="corn"}(f||(f={}))}},t={};function s(i){var n=t[i];if(void 0!==n)return n.exports;var o=t[i]={exports:{}};return e[i](o,o.exports,s),o.exports}s.d=(e,t)=>{for(var i in t)s.o(t,i)&&!s.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),s(184),s(939),s(846),s(112)})();